pipeline:
  build:
    image: anapsix/alpine-java:8_jdk
    commands:
      - ./gradlew clean build

  publish:
    image: plugins/docker
    repo: laszlocloud/java-app
    tags: [ latest ]
    secrets: [ docker_username, docker_password ]

  deploy:
    image: ubuntu
    commands:
      - cat java-app.yml
      - curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
      - chmod +x ./kubectl
      - kubectl -s https://api.theselfservicedev.com:6443 get pods
